<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Jeff Carpenter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<style>
* {
  margin: 0;
  padding: 0;
}
body {
  overflow: hidden;
  background-color: #222;
  -webkit-font-smoothing: antialiased;
  font-family: "Helvetica Neue", "Helvetica", "Arial", sans-serif;
}
#display {
}
#island {
  position: absolute;
  top: 0;
  margin: 1em 0 0 1em;
  padding: 1em;
  color: white;
}
a {
  text-decoration: none;
}
h1 {
  font-size: 20px;
  margin: 0 0 .4em;
  background-color: #222;
  padding: 0.1em;
}
#island > div {
  margin-bottom: 0.4em;
}
p {
  background-color: #222;
  padding: 0.2em;
  display: inline;
}
p small {
  font-size: 16px;
  margin-right: 0.5em;
  font-weight: bold;
}
p a, p span {
  color: white;
  font-size: 16px;
  margin-right: 0.4em;
}
p a:hover, p span:hover {
  color: #ddd;
  cursor: pointer;
}
</style>
</head>
<body>

  <canvas 
    id="display" 
    ></canvas>

    <div id="island">
      <h1>Hi! I'm Jeff Carpenter, a software developer living in San Francisco.</h1>

      <div>
        <p>
          <small>Currently</small>
          <a href="http://blogging.jeff.is/">Blog</a>
          <a href="https://bloodhound.com/">Bloodhound</a>
          <a href="http://rcrd.org/">rcrd</a>
        </p>
      </div>

      <div>
        <p>
          <small>Elsewhere</small>
          <a href="https://github.com/jeffcarp">GitHub</a>
          <a href="https://www.quora.com/Jeff-Carpenter-2">Quora</a>
          <a href="http://vimeo.com/jeef">Vimeo</a>
        </p>
      </div>

      <div>
        <p>
          <small>Contact</small>
          <a href="mailto:hi@jeff.is">hi@jeff.is</a>
          <a href="https://twitter.com/jcarp">@jcarp</a>
        </p>
      </div>

      <div>
        <p>
          <small>Extra</small>
          <span onclick="toggleLanguage()">日本語</span>
        </p>
      </div>
    </div>

<script>
var graph;
var canvas;
var start;
var end;
var walls = [];
var midX, midY;

var rand = function(num) {
  // Exclusive! 
  return Math.floor(Math.random()*num);
};

// Returns a tuple with a random coordinate picked out from the input graph
var pickRandomCell = function() {
  var y = rand(graph.length);
  var x = rand(graph[0].length);
  return [y, x];
};

var generateSquareGraph = function(sizeY, sizeX) {
  var graph = [];
  for (var i=0; i<sizeY; i++) {
    graph[i] = [];
    for (var j=0; j<sizeX; j++) {
      graph[i][j] = false; // false == wall
    }
  }
  return graph;
};

var resetCanvasAspect = window.onresize = function() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
};

var neighboringWallsOfCell = function(cell) {
  return [[-1, 0], [1, 0], [0, -1], [0, 1]].map(function(dir) {
    var y = cell[0] + dir[0];
    var x = cell[1] + dir[1];
    return [y, x];
  }).filter(function(c) {
    return graph[c[0]] && graph[c[0]][c[1]] === false;
  });
};

var randomNeighborCell = function(cell) {
  var neighbors = [[-1, 0], [1, 0], [0, -1], [0, 1]].map(function(dir) {
    var y = cell[0] + dir[0];
    var x = cell[1] + dir[1];
    return [y, x];
  }).filter(function(c) {
    return isCell(c);
  });
  if (!neighbors.length) {
    console.log("no cells");
  }
  else {
    return neighbors[rand(neighbors.length)];
  }
};

var draw = function() {
  graph.forEach(function(row, y) {
    row.forEach(function(col, x) {

      var rectWidth = window.innerWidth / graph[0].length;
      var rectHeight = window.innerHeight / graph.length;
      var rectX = x * rectWidth;
      var rectY = y * rectHeight;

      if (isCell([y, x])) {
        ctx.fillStyle = "hsl("+ graph[y][x] +", 50%, 50%)";
        ctx.fillRect(rectX, rectY, rectWidth, rectHeight);
        // TODO: If a cell's neighbors of depth 2 are all filled out, remove this cell (and its walls?)
        
      } 

    });
  });
};

var oppositeCell = function(from, to) {
  var yDiff = to[0] - from[0];
  var xDiff = to[1] - from[1];
  var coord = [to[0] + yDiff, to[1] + xDiff];
  return at(coord) !== undefined ? coord : null;
};

var at = function(coord) {
  return coord && graph[coord[0]] && graph[coord[0]][coord[1]];
}; 

var isCell = function(coord) {
  var cell = at(coord);
  return cell !== false && cell !== undefined;
};

var isWall = function(coord) {
  return at(coord) === false;
};

canvas = document.getElementById("display");
if (canvas.getContext) {
  ctx = canvas.getContext("2d");
}
else {
  alert("To view please use a browser that supports canvas.");
}
resetCanvasAspect();

var factor = 10;
var sizeY = Math.floor(window.innerHeight / factor);
var sizeX = Math.floor(window.innerWidth / factor);
graph = generateSquareGraph(sizeY, sizeX);
midY = Math.floor(graph.length / 2);
midX = Math.floor(graph[0].length / 2);
var current = [midY, midX];
graph[current[0]][current[1]] = rand(256);
walls = walls.concat(neighboringWallsOfCell(current));

var interv = function() {

  if (!walls.length) {
    console.log("no more walls"); 
    return;
  }

  var wall = walls[rand(walls.length)];
  var cell = randomNeighborCell(wall);
  var opposite = oppositeCell(cell, wall);
  if (opposite && !isCell(opposite)) {
    var off = 9;
    var diff = rand(off*2) - off;
    var newWallHue = at(cell) + diff;
    if (newWallHue < 0) {
      newWallHue = 0; 
    }
    if (newWallHue > 255) {
      newWallHue = 255;
    }
    var diff = rand(off*2) - off;
    graph[wall[0]][wall[1]] = newWallHue; 
    var newOppHue = at(cell) + diff;
    if (newOppHue < 0) {
      newOppHue = 0; 
    }
    if (newOppHue > 255) {
      newOppHue = 255;
    }
    graph[opposite[0]][opposite[1]] = newOppHue; 
    walls = walls.concat(neighboringWallsOfCell(opposite));
  }
  var i = walls.indexOf(wall);
  if (!!~i) walls.splice(i, 1);
};

window.requestAnimFrame = (function(){
  return (
    window.requestAnimationFrame       ||
    window.webkitRequestAnimationFrame ||
    window.mozRequestAnimationFrame    ||
    window.setTimeout.bind(this, callback, 1000 / 60));
})();

(function animationLoop() {
  if (walls.length) {
    interv();
    draw();
    requestAnimFrame(animationLoop);
  } else {
    console.log("Done.");
  }
})();

var lang = "english";
window.toggleLanguage = function() {
  if (lang === "english") {
    document.getElementsByTagName("h1")[0].innerText = "こんいちわ、ジェフ大工と申します。サンフランシスコに住んでいる開発者です。どうぞよろしくお願いします！";
    document.querySelector("span").innerText = "English";
    document.querySelectorAll("small")[0].innerText = "最新プロジェクト";
    document.querySelectorAll("small")[1].innerText = "プロファイル";
    document.querySelectorAll("small")[2].innerText = "問合先";
    document.querySelectorAll("small")[3].innerText = "言語";

  }
  else {
    document.getElementsByTagName("h1")[0].innerText = "Hi! I'm Jeff Carpenter, a software developer living in San Francisco.";
    document.querySelector("span").innerText = "日本語";
    document.querySelectorAll("small")[0].innerText = "Currently";
    document.querySelectorAll("small")[1].innerText = "Elsewhere";
    document.querySelectorAll("small")[2].innerText = "Contact";
    document.querySelectorAll("small")[3].innerText = "Extra";
  }
  lang = lang === "english" ? "nihongo" : "english";
};

</script>


</body>
</html>
